

# å¿«é€Ÿæ„å»ºä¸€ä¸ªç¥ç»ç½‘ç»œ

[TOC]

â­æœ¬æ–‡å†…å®¹ï¼šå·ç§¯ï¼Œæ± åŒ–ï¼Œéçº¿æ€§æ¿€æ´»ï¼Œçº¿æ€§ç»„åˆï¼Œä»¥åŠå¿«é€Ÿæ­å»ºä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œ

## åŸºæœ¬éª¨æ¶

```python
import torch
import torch.nn as nn

class RecoModel(nn.Module):
  def __init__(self):
    super(RecoModel,self).__init__()  #å°†å­æ¨¡å—æŒ‡å®šä¸ºé»˜è®¤å±æ€§
    
  def forward(self,input):  #å®šä¹‰ä¸€ä¸ªå‘å‰ä¼ æ’­çš„å‡½æ•°
    output = input+1
    return output
```

1ï¸âƒ£`forward()`å®šä¹‰äº†æ¯æ¬¡æ‰§è¡Œçš„ è®¡ç®—æ­¥éª¤ã€‚ åœ¨æ‰€æœ‰çš„Moduleä¸­éƒ½éœ€è¦é‡å†™è¿™ä¸ªå‡½æ•°

2ï¸âƒ£`RecoModel()(input)`çš„ input å¿…é¡»æ˜¯tensoræ ¼å¼

```python
Model = RecoModel()
x = torch.tensor(1.0)
output = Model(x)  #ç›¸å½“äºRecoModel()()
print(output)
```



## å·ç§¯å±‚

> **torch.nn.Conv2d()**å‡½æ•°
>
> - ç¤ºä¾‹ï¼šself.conv1 = Conv2d(in_channels=3,out_channels=6,kernel_size=3,stride=1,padding=0)
> - ä½œç”¨ï¼šå¯¹å›¾åƒè¿›è¡Œ2Då·ç§¯
> - å‚æ•°ï¼š
>   - ğŸŒˆin_channelsï¼šè¾“å…¥çš„é¢œè‰²é€šé“æ•°ï¼Œå½©è‰²ä¸º3
>   - ğŸš€out_channelsï¼šå·ç§¯äº§ç”Ÿçš„è¾“å‡ºé€šé“æ•°
>   - kernel_sizeï¼šå·ç§¯æ ¸çš„å¤§å°
>   - strideï¼šå·ç§¯æ ¸ç§»åŠ¨çš„æ­¥é•¿
>   - paddingzï¼šæ˜¯å¦å¡«å……ï¼Œè¾¹ç¼˜å¤„å°äºå·ç§¯æ ¸åˆ™ç”¨0å¡«å……
>

å·ç§¯çš„æ¦‚å¿µï¼š[conv_arithmetic/README.md at master Â· vdumoulin/conv_arithmetic (github.com)](https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md)

out_channels=2æ—¶ï¼Œ2ä¸ªå·ç§¯æ ¸åœ¨å›¾åƒä¸Šæ»‘åŠ¨ï¼Œæœ€åå¾—åˆ°2ä¸ªé€šé“



### å®šä¹‰æ¨¡å‹

```python
class Model(nn.Module):
  def __init__(self):
    super(Model,self).__init__()
    self.conv1 = Conv2d(in_channels=3,out_channels=6,kernel_size=3,stride=1,padding=0)
  
  def forward(self,x):
    x = self.conv1(x)
    return x
```

å®šä¹‰ä¸€å±‚å·ç§¯å±‚ï¼ˆ2Då·ç§¯ï¼‰ï¼Œè¾“å‡ºé€šé“æ•°ä¸º6



### åŠ è½½æ•°æ®é›†

```python
dataset = torchvision.datasets.CIFAR10("/content/gdrive/MyDrive/Learn-		   pytorch/dataset",train=False,transform=torchvision.transforms.ToTensor())

dataloader = DataLoader(dataset,batch_size=64)
```

> **torchvision.datasets.CIFAR10()**å‡½æ•°
>
> - ç¤ºä¾‹ï¼šdataset = torchvision.datasets.CIFAR10("/content/gdrive/MyDrive/Learn-		     pytorch/dataset",train=False,transform=torchvision.transforms.ToTensor())
> - ä½œç”¨ï¼šä¸‹è½½æ•°æ®é›†
>
> - å‚æ•°ï¼š
>   - CIFAR10ï¼šå®˜æ–¹æ•°æ®é›†çš„åå­—
>   - train=Falseï¼šæ˜¯å¦ä¸‹è½½è®­ç»ƒé›†ã€‚å¦ï¼Œåˆ™ä¸‹è½½æµ‹è¯•é›†
>   - ğŸ”transform=torchvision.transforms.ToTensor():è½¬æ¢ä¸ºTensoræ•°æ®ç±»å‹



### å›¾ç‰‡å·ç§¯

```python
for data in dataloader:
  imgs,targets = data
  out = Model()(imgs)
  print(imgs.shape)
  print(out.shape)
  writer.add_images("input",imgs,step)
  out = torch.reshape(out,(-1,3,30,30))
  writer.add_images("output",out,step)
  step=step+1
```

[First cycle output] :torch.Size([64, 3, 32, 32]) torch.Size([64, 6, 30, 30])

ğŸ”¥åœ¨æ•°æ®é›†ï¼ˆdataloaderï¼‰ä¸­è¯»å–æ¯ä¸€ä»½dataï¼Œæ¯ä¸€ä¸ªdataéƒ½åŒ…å«imgs(å›¾ç‰‡ï¼Œtensoræ ¼å¼),targets(æ ‡ç­¾)

âš¡å·ç§¯å‰åçš„å›¾åƒå¯¹æ¯”ï¼š

![image-20220510152122807](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205101521853.png)

![image-20220510152156687](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205101521737.png)



## æ± åŒ–å±‚

æ± åŒ–æ ¸æ¯ç§»åŠ¨ä¸€ä¸ªæ­¥é•¿ï¼Œç„¶åå–æ± åŒ–æ ¸æ‰€è¦†ç›–çš„å›¾ç‰‡ï¼Œå…¶èŒƒå›´å†…çš„æœ€å¤§å€¼

åœ¨å·ç§¯å±‚æ­¥é•¿é»˜è®¤ä¸º1ï¼Œåœ¨æ± åŒ–å±‚æ­¥é•¿ä¸ºstep=kernel_size=3

```python
from torch.nn import MaxPool2d 
class Pool_test(nn.Module):
  def __init__(self):
    super(Pool_test,self).__init__()
    self.maxpool1 = MaxPool2d(kernel_size=3,ceil_mode=False)

  def forward(self,input):
    output = self.maxpool1(input)
    return output

test=Pool_test()
```



> **MaxPool2d()**å‡½æ•°
>
> - ç¤ºä¾‹ï¼šself.maxpool1 = MaxPool2d(kernel_size=3,ceil_mode=False)
> - ä½œç”¨ï¼šæ± åŒ–ï¼Œç›¸å½“äºç»™å›¾ç‰‡æ‰“é©¬èµ›å…‹
> - å‚æ•°ï¼š
>   - kernel_sizeï¼šæ± åŒ–æ ¸çª—å£å¤§å°
>   - ceil_modeï¼šå¦‚æœç­‰äº`True`ï¼Œè®¡ç®—è¾“å‡ºä¿¡å·å¤§å°çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨å‘ä¸Šå–æ•´ï¼Œä»£æ›¿é»˜è®¤çš„å‘ä¸‹å–æ•´çš„æ“ä½œ



### æ± åŒ–æ ¸çš„ç§»åŠ¨

<img src="https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161024721.png" alt="image-20220510145114454" style="zoom:67%;" />



<img src="https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161024407.png" alt="image-20220510145321001" style="zoom:67%;" />





<img src="https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161024176.png" alt="image-20220510145344930" style="zoom:67%;" />







### æ± åŒ–çš„ä½œç”¨

æ¨¡ç³Šã€é©¬èµ›å…‹



![image-20220510151644638](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205101516728.png)



![image-20220510151711976](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205101517013.png)





## éçº¿æ€§æ¿€æ´»

ä½¿å¾—ç¥ç»ç½‘ç»œå¯ä»¥ä»»æ„é€¼è¿‘ä»»ä½•éçº¿æ€§å‡½æ•°

å¦‚æœæ²¡æœ‰éçº¿æ€§å±‚ï¼Œæ— è®ºç¥ç»ç½‘ç»œæœ‰å¤šå°‘å±‚ï¼Œè¾“å‡ºéƒ½æ˜¯è¾“å…¥çš„çº¿æ€§ç»„åˆ

ä½¿ç”¨ä¸€ä¸ª`sigmoid1()`å‡½æ•°çš„æ•ˆæœå¯¹æ¯”ï¼š





![image-20220511092650192](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205110926377.png)



![image-20220511092730100](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205110927237.png)











## æ­å»ºä¸€ä¸ªç¥ç»ç½‘ç»œ

![image-20220516103813258](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161038343.png)

```python
self.model1 = Sequential(
            Conv2d(3,32,5,1,2),
            MaxPool2d(2),
            Conv2d(32,32,5,1,2),
            MaxPool2d(2),
            Conv2d(32,64,5,1,2),
            MaxPool2d(2),
            Flatten(),
            Linear(1024,64),
            Linear(64,10),
            )
```



- **å·ç§¯**1

  ![image-20220516111051021](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161110064.png)

  ğŸºè¾“å…¥ä¸€ä¸ª3@32x32çš„å›¾åƒï¼Œç»è¿‡5 x 5çš„å·ç§¯æ ¸ï¼Œè¾“å‡ºä¸€ä¸ª32é€šé“ï¼Œ32x32å¤§å°çš„å›¾åƒï¼š`Conv2d(3,32,5,1,2)`

  3-é€šé“æ•°ï¼›32-å›¾åƒå°ºå¯¸ï¼›5-å·ç§¯æ ¸å¤§å°

  padingè®¡ç®—ï¼Ÿ

  <img src="https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161046638.png" alt="image-20220516104615579" style="zoom: 80%;" />

  Hin=32ï¼Œpadding[0]=?,dilation[0]é»˜è®¤ä¸º1ï¼Œkernel_size[0]=5,stride[0]è®¾ç½®ä¸º1ï¼ˆæˆ‘ä»¬è®¾æ¯ä¸€æ¬¡å·ç§¯æ ¸ç§»åŠ¨1ä¸ªåƒç´ ç‚¹ï¼‰ï¼ŒHout=32

  åˆ™ï¼špadding[0]=2;stride=1



- **æ± åŒ–1**

  ![image-20220516111123213](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161111258.png)

  `MaxPool2d(2)`ï¼Œæ± åŒ–æ ¸å¤§å°ä¸º2

  

- **å·ç§¯2**

  ![image-20220516111152044](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161111096.png)

  è¾“å…¥ä¸€ä¸ª32@32*32çš„å›¾åƒï¼Œç»è¿‡5 x 5çš„å·ç§¯æ ¸ï¼Œè¾“å‡ºä¸€ä¸ª32é€šé“ï¼Œ32x32å¤§å°çš„å›¾åƒï¼š`Conv2d(32,32,5,1,2)`

- **æ± åŒ–2**

- **å·ç§¯3**

  ![image-20220516110757830](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161107879.png)

  è¾“å…¥ä¸€ä¸ª32@8x8çš„å›¾åƒï¼Œç»è¿‡5 x 5çš„å·ç§¯æ ¸ï¼Œè¾“å‡º64@8x8çš„å›¾åƒ

- **æ± åŒ–3**

- **å±•å¹³å±‚**

  ![image-20220516111445976](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161114022.png)

  å°†64@4x4çš„tensorç±»å‹çš„å›¾åƒï¼Œè½¬æˆ64x4x4=1024çš„ä¸€ç»´å‘é‡æ•°ç»„

- **çº¿æ€§å±‚1**

  å¯¹è¾“å…¥æ•°æ®åšçº¿æ€§å˜æ¢ï¼šy=Ax+b

  ![image-20220516120831062](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161208108.png)

  `Linear(1024,64)`ï¼Œ1024æ˜¯è¾“å…¥å‘é‡ç»„çš„é•¿åº¦ï¼Œ64æ˜¯è¾“å‡ºçš„é•¿åº¦

  

- **çº¿å½¢å±‚2**

  ![image-20220516121022535](https://yzfzzz.oss-cn-shenzhen.aliyuncs.com/image/202205161210575.png)

  å°†64ä¸ªè¾“å…¥ç»§ç»­çº¿æ€§ç»„åˆï¼Œæœ€ç»ˆè¾“å‡º10ï¼ˆå› ä¸ºæœ€ååˆ†ç±»çš„å›¾åƒä¸€å…±æœ‰åä¸ªç±»åˆ«ï¼‰ï¼š`Linear(64,10)`

  









